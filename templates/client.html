<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

  <style>
/* --- Style gÃ©nÃ©ral --- */
body {
  font-family: 'Arial', sans-serif;

  /* DÃ©gradÃ© symÃ©trique */
  background: linear-gradient(
    315deg,
    #FFD699,
    #FF7F50,
    #FF5722,
    #FF7F50,
    #FFD699,
    #FF7F50,
    #FF5722,
    #FF7F50,
    #FFD699
  );
  background-size: 400% 400%;
  animation: waveMove 30s linear infinite;

  color: #3B2F2F;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

/* Titres â€” mÃªme gradient que body */
#titre {
  font-family: 'Fredoka One', cursive;
  font-size: 4rem;
  font-weight: bold;
  text-align: center;

  /* MÃªme gradient que body */
  background: linear-gradient(
    315deg,
    #FFD699,
    #FF7F50,
    #FF5722,
    #FF7F50,
    #FFD699,
    #FF7F50,
    #FF5722,
    #FF7F50,
    #FFD699
  );
  background-size: 400% 400%;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;

  /* MÃªme animation */
  animation: waveMove 30s linear infinite;
}

/* Animation diagonale â†˜ */
@keyframes waveMove {
  0%   { background-position: 100% 100%; }
  100% { background-position: 0% 0%; }
}

/* Conteneurs principaux */
#index, #round, #ChoixPileFace, #ResPileFace {
  background-color: rgba(255, 255, 255, 0.95);
  padding: 2%;
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.25);
  width: 75vw;
  min-height: 75vh;
  height: auto;
  max-width: 1200px;
  max-height: none;
  text-align: center;
  margin: auto;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  box-sizing: border-box;
  perspective: 800px;
}

/* Titres */
h1 { margin-bottom: 25px; font-size: 2.5em; }
h3 { color: #E67E22; margin-bottom: 15px; font-size: 1.5em; }

/* --- Nouveau style pour lâ€™input + bouton sur la mÃªme ligne --- */
#joinContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}

#joinContainer input[type="text"] {
  padding: 10px;
  font-size: 16px;
  width: 200px;
  border-radius: 12px;
  border: 1px solid #FFA07A;
  transition: all 0.2s;
}

#joinContainer input[type="text"]:focus {
  border-color: #FF4500;
  box-shadow: 0 0 5px rgba(255, 69, 0, 0.5);
  outline: none;
}

button {
  /* Gradient identique au body/titre */
  background: linear-gradient(
    315deg,
    #FFD699,
    #FF7F50,
    #FF5722,
    #FF7F50,
    #FFD699,
    #FF7F50,
    #FF5722,
    #FF7F50,
    #FFD699
  );
  background-size: 400% 400%;
  color: white;
  border: none;
  border-radius: 12px;
  padding: 12px 25px;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s, background-color 0.2s;
  
  /* Clip text si tu veux seulement pour le texte */
  /* background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; */
  
  /* Animation */
  animation: waveMove 30s linear infinite;
}

button:hover {
  transform: scale(1.1);
}

button:hover {
  transform: scale(1.1);
  background-color: #FF4500;
}

/* Pile / Face */
#ChoixPileFace { display: none; }
#ChoixPileFace button img { width: 120px; height: 120px; }

#commencer {
  margin-top: 20px;
}

/* PiÃ¨ce animÃ©e */
#coin-container {
  perspective: 1200px;
  width: 160px;
  height: 160px;
  margin: auto;
}

#coin .face img { width: 100px; height: 100px; }
#coin {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 3s ease-out;
}
.face {
  position: absolute;
  width: 160px;
  height: 160px;
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: bold;
  color: white;
  border-radius: 50%;
}
.front { background: #FF8C00; }
.back { background: #D35400; transform: rotateY(180deg); }

/* Liste des joueurs */
#listeJoueurs {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 colonnes */
  gap: 20px;                             /* espace entre les cartes */
  justify-items: stretch;                 /* chaque joueur prend toute la largeur de sa colonne */
  align-items: start;
  margin-top: 10px;
}

#listeJoueurs div {
  background-color: #FFE4C4; 
  color: #3B2F2F;
  gap : 10px;
  padding: 20px 25px;
  border-radius: 12px;
  width: 100%;
  box-sizing: border-box;
  text-align: left;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

#listeJoueurs div:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

#listeJoueurs div button {
  background-color: #FF8C00;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 6px 12px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s;
}

#listeJoueurs div button:hover {
  background-color: #FF4500;
  transform: scale(1.1);
}

/* Responsive pour que la grille sâ€™adapte */
@media (max-width: 1024px) {
  #listeJoueurs { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 768px) {
  #listeJoueurs { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 480px) {
  #listeJoueurs { grid-template-columns: 1fr; }
}

#index { max-height: 90vh; overflow-y: auto; }

/* --- Responsive --- */
@media (max-width: 1024px) {
  #index, #round, #ChoixPileFace, #ResPileFace {
    width: 85vw;
    height: auto;
    padding: 4%;
  }
  #listeJoueurs { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 768px) {
  #index, #round, #ChoixPileFace, #ResPileFace {
    width: 90vw;
    height: auto;
    padding: 5%;
    font-size: 0.95em;
  }
  #joinContainer input[type="text"], #joinContainer button { width: auto; font-size: 16px; }
  #listeJoueurs { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 480px) {
  #index, #round, #ChoixPileFace, #ResPileFace {
    width: 95vw;
    height: auto;
    padding: 5%;
    font-size: 0.9em;
  }
  #joinContainer input[type="text"], #joinContainer button { width: 100%; font-size: 14px; }
  #listeJoueurs { grid-template-columns: 1fr; }
}
  </style>
</head>
<body>
  <div id="index">
    <h1 id="titre">Jeu de la PiÃ¨ce</h1>
    
    <!-- Conteneur horizontal pour input + bouton -->
    <div id="joinContainer">
      <input type="text" id="nomJoueur" placeholder="Entrez votre nom">
      <button onclick="rejoindreJeu()">Rejoindre le jeu</button>
    </div>

    <h3>Liste des joueurs :</h3>
    <div id="listeJoueurs"></div>
    <div id="commencer">
      <button onclick="commencerJeu()">START !</button>
    </div>
  </div>

  <div id="round" style="display: none;">
    <div id="PhrasePseudo"></div>
    <div id="LaQuestion"></div>
  </div>

  <div id="ChoixPileFace">
    <div class="option">
      <h2>Choisis entre Pile et Face</h2>
      <button id="btnPile" onclick="envoyerChoixP()">
        <img src="{{ url_for('static', filename='pile.png') }}" alt="PILE" />
      </button>
      <span>Pile</span>
    </div>
    <div class="option">
      <button id="btnFace" onclick="envoyerChoixF()">
        <img src="{{ url_for('static', filename='face.png') }}" alt="FACE" />
      </button>
      <span>Face</span>
    </div>
  </div>

  <div id="ResPileFace" style="display:none;">
    <div id="coin-container">
      <div id="coin">
        <div class="face front"><img src="{{ url_for('static', filename='pile.png') }}" alt="PILE" /></div>
        <div class="face back"><img src="{{ url_for('static', filename='face.png') }}" alt="FACE" /></div>
      </div>
    </div>
    <div id="resultat" style="margin-top:20px; font-size:20px; font-weight:bold;"></div>
  </div>
  <script>
    // Automatiser la sÃ©paration des lettres du titre
    const titre = document.getElementById('titre');
    const text = titre.textContent;
    titre.textContent = '';
    text.split('').forEach(char => {
      const span = document.createElement('span');
      span.textContent = char;
      titre.appendChild(span);
    });
  </script>
    
    <script>
        var socket = io({ transports: ['websocket'], upgrade: false });

        // -------- ROOMS --------
        var room = Math.random().toString(36).substring(2, 8); // id unique auto par client
        console.log("Room perso:", room);

        var choix;
        var questionActuelle = "";

        // --------- FONCTIONS UTILITAIRES ---------
        function resetRound() {
            document.getElementById("round").style.display = 'none';
            document.getElementById("ChoixPileFace").style.display = 'none';
            document.getElementById("ResPileFace").style.display = 'none';

            const coin = document.getElementById("coin");
            const affichage = document.getElementById("resultat");
            coin.style.transition = "none";
            coin.style.transform = "rotateY(0deg)";
            affichage.textContent = "";

            document.getElementById("LaQuestion").innerHTML = "";
            document.getElementById("PhrasePseudo").innerHTML = "";
        }

        function afficherPieceAvantResultat() {
        const resDiv = document.getElementById("ResPileFace");
        const coin = document.getElementById("coin");
        const affichage = document.getElementById("resultat");

        // â¬‡ï¸ Nettoyage immÃ©diat des Ã©lÃ©ments du round prÃ©cÃ©dent
        const oldQ = document.getElementById("affQuest");
        if (oldQ) oldQ.remove();
        const oldBtnShow = document.getElementById("btnAfficherQuestion");
        if (oldBtnShow) oldBtnShow.remove();
        const oldBtnNew = document.getElementById("btnNewRound");
        if (oldBtnNew) oldBtnNew.remove();

        // reset visuel de la piÃ¨ce + efface le texte de rÃ©sultat
        resDiv.style.display = 'block';
        coin.style.transition = "none";
        coin.style.transform = "rotateY(0deg)";
        affichage.textContent = "";
        }


        // --------- FONCTIONS DE JEU ---------
        function rejoindreJeu() {
            const nomJoueur = document.getElementById("nomJoueur").value.trim();
            if (nomJoueur) {
                socket.emit('NouvJoueur', {room: room, pseudo: nomJoueur});
                document.getElementById("nomJoueur").value = "";
            } else {
                alert("Veuillez entrer un pseudo valide");
            }
        }
        
        function commencerJeu() {
            resetRound();
            document.getElementById("index").style.display = 'none';
            document.getElementById("round").style.display = 'block';
            socket.emit('lancerRound', {room: room});
            socket.emit('chargerQuestion', {room: room});
        }
        
        function demanderQuestion() {
            socket.emit('demandeQuestion', {room: room});
            document.getElementById("decrocher").style.display = 'none';
        }
        
        function afficherChoixPileFace() {
            document.getElementById("round").style.display = 'none';
            document.getElementById("ChoixPileFace").style.display = 'block';
        }
        
        function envoyerChoixP() {
            choix = "pile";
            afficherPieceAvantResultat();
            socket.emit("envoyerResPileFace", {room: room});
            document.getElementById("ChoixPileFace").style.display = 'none';
            document.getElementById("LaQuestion").innerHTML = "";
        }
        
        function envoyerChoixF() {
            choix = "face";
            afficherPieceAvantResultat();
            socket.emit("envoyerResPileFace", {room: room});
            document.getElementById("ChoixPileFace").style.display = 'none';
            document.getElementById("LaQuestion").innerHTML = "";
        }
        
        function lancerAnimationPileFace(resultat) {
            const coin = document.getElementById("coin");
            const affichage = document.getElementById("resultat");
            const round = document.getElementById('LaQuestion');

            let tours = 4;
            let angleFinal = (resultat === "pile") ? 0 : 180;

            coin.style.transition = "none";
            coin.style.transform = "rotateY(0deg)";
            void coin.offsetWidth;

            coin.style.transition = "transform 3s ease-out";
            coin.style.transform = `rotateY(${tours * 360 + angleFinal}deg)`;

            document.getElementById("ResPileFace").style.display = 'block';

            setTimeout(() => {
                affichage.textContent = (choix === resultat) ? "ðŸŽ‰ GAGNÃ‰ !" : "âŒ PERDU !";
                affichage.style.color = (choix === resultat) ? "green" : "red";

                if (choix === resultat){
                    const ancienBtn = document.getElementById("btnAfficherQuestion");
                    if (ancienBtn) ancienBtn.remove();
                    let btnAfficherQuestion = document.createElement("button")
                    btnAfficherQuestion.id = "btnAfficherQuestion";
                    btnAfficherQuestion.textContent ="Afficher la question si pÃ©nalitÃ©"
                    let ancienQuest = document.getElementById("affQuest")
                    if (ancienQuest) ancienQuest.remove();
                    let affQuest = document.createElement("span")
                    affQuest.textContent = questionActuelle
                    affQuest.id="affQuest"
                    affQuest.style.display = 'none'
                    affichage.parentNode.appendChild(affQuest)
                    btnAfficherQuestion.onclick = () => {
                        affQuest.style.display ='block'
                        btnAfficherQuestion.style.display = 'none'
                    }
                    affichage.parentNode.appendChild(btnAfficherQuestion)
                }
                if (choix !== resultat){
                    let ancienQuest = document.getElementById("affQuest")
                    if (ancienQuest) ancienQuest.remove();
                    let affQuest = document.createElement("span")
                    affQuest.id="affQuest"
                    affQuest.textContent = questionActuelle
                    affichage.parentNode.appendChild(affQuest)
                }
                const ancienBtn = document.getElementById("btnNewRound");
                if (ancienBtn) ancienBtn.remove();
                let btnNewRound = document.createElement("button");
                btnNewRound.id = "btnNewRound"
                btnNewRound.textContent = "Nouveau Round";
                btnNewRound.onclick = () => {
                    socket.emit('lancerRound', {room: room});
                    resetRound();
                    document.getElementById("round").style.display = 'block';
                };
                affichage.parentNode.appendChild(btnNewRound);
            }, 3000);
        }
        
        // --------- SOCKETS ---------
        socket.on('majListe', (liste) => {
    const zone = document.getElementById("listeJoueurs");
    zone.innerHTML = "";
    liste.forEach(joueur => {
        const joueurDiv = document.createElement("div");

        const nom = document.createElement("span");
        nom.textContent = joueur;

        const bouton = document.createElement("button");
        bouton.textContent = "âŒ";
        bouton.onclick = () => {
            socket.emit('SupprimerJoueur', {room: room, pseudo: joueur});
        };

        joueurDiv.appendChild(nom);
        joueurDiv.appendChild(bouton);
        zone.appendChild(joueurDiv);
    });
});

        
        socket.on('AfficheNomJoueurR', (data) => {
            if (data) {
                const round = document.getElementById('PhrasePseudo');
                round.innerHTML = "";
        
                const phrase = document.createElement("span");
                phrase.textContent = data + " on t'appelle !";
        
                const bouton = document.createElement("button");
                bouton.id = "decrocher";
                bouton.textContent = "DÃ©crocher !";
                bouton.onclick = demanderQuestion;
        
                round.appendChild(phrase);
                round.appendChild(bouton);
            }
        });
        
        socket.on('AfficherQuestion', (data) => {
            if (data) {
                questionActuelle = data
                const round = document.getElementById('LaQuestion');
                round.innerHTML = "";
        
                const phrase = document.createElement("span");
                phrase.textContent = data;
        
                const bouton = document.createElement("button");
                bouton.textContent = "Suivant";
                bouton.onclick = afficherChoixPileFace;
        
                round.appendChild(phrase);
                round.appendChild(bouton);
            }
        });
        
        socket.on('ResPileFace', (data) => {
            lancerAnimationPileFace(data);
        });
    </script>
</body>
</html>
