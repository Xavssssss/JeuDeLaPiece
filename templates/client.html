<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <style>
    /* --- Style g√©n√©ral --- */
body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(to bottom, #FFD699, #FF7F50);
  color: #3B2F2F;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center; /* centre horizontalement */
  align-items: center;    /* centre verticalement */
  min-height: 100vh;
}

/* Conteneurs principaux */
#index, #round, #ChoixPileFace, #ResPileFace {
  background-color: rgba(255, 255, 255, 0.95);
  padding: 40px;             /* plus de padding pour "grossir" */
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.25);
  width: 600px;               /* plus large */
  max-width: 90%;             /* responsive sur mobile */
  text-align: center;
  margin: 20px auto;          /* centr√© horizontalement si flex chang√© */
}

/* Titres */
h1 { color: #D35400; margin-bottom: 25px; font-size: 2.5em; }
h3 { color: #E67E22; margin-bottom: 15px; font-size: 1.5em; }

/* Input */
input[type="text"] {
  padding: 15px;
  border-radius: 12px;
  border: 1px solid #FFA07A;
  width: 90%;
  margin-bottom: 20px;
  font-size: 18px;
}

/* Boutons */
button {
  background-color: #FF8C00;
  border: none;
  border-radius: 12px;
  padding: 12px 25px;
  font-size: 18px;
  color: white;
  cursor: pointer;
  margin: 8px;
  transition: transform 0.2s, background-color 0.2s;
}

button:hover { transform: scale(1.1); background-color: #FF4500; }

/* Pile / Face */
#ChoixPileFace {
  display: none;
}

#ChoixPileFace button img {
  width: 120px;  /* plus grande */
  height: 120px;
}

/* Pi√®ce anim√©e */
#coin-container {
  perspective: 1200px;
  width: 160px;
  height: 160px;
  margin: auto;
}

#coin .face img {
  width: 100px;
  height: 100px;
}

#coin {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 3s ease-out;
}

.face {
  position: absolute;
  width: 160px;
  height: 160px;
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: bold;
  color: white;
  border-radius: 50%;
}

.front { background: #FF8C00; }
.back { background: #D35400; transform: rotateY(180deg); }

  </style>
</head>
<body>
    <div id="index">
        <h1>Jeu de la Pi√®ce</h1>
        <input type="text" id="nomJoueur" placeholder="Entrez votre nom">
        <button onclick="rejoindreJeu()">Rejoindre le jeu</button>
        <h3>Liste des joueurs :</h3>
        <div id="listeJoueurs"></div>
        <div id="commencer">
            <button onclick="commencerJeu()">START !</button>
        </div>
    </div>

    <div id="round" style="display: none;">
        <div id="PhrasePseudo"></div>
        <div id="LaQuestion"></div>
    </div>

    <div id="ChoixPileFace">
        <div class="option">
            <h2>Choisis entre Pile et Face</h2>
            <button id="btnPile" onclick="envoyerChoixP()">
                <img src="{{ url_for('static', filename='pile.png') }}" alt="PILE" />
            </button>
            <span>Pile</span>
        </div>
        <div class="option">
            <button id="btnFace" onclick="envoyerChoixF()">
                <img src="{{ url_for('static', filename='face.png') }}" alt="FACE" />
            </button>
            <span>Face</span>
        </div>
    </div>
    
    <div id="ResPileFace" style="display:none;">
        <div id="coin-container">
            <div id="coin">
                <div class="face front"><img src="{{ url_for('static', filename='pile.png') }}" alt="PILE" /></div>
                <div class="face back"><img src="{{ url_for('static', filename='face.png') }}" alt="FACE" /></div>
            </div>
        </div>
        <div id="resultat" style="margin-top:20px; font-size:20px; font-weight:bold;"></div>
    </div>
    
    <script>
        var socket = io({
            transports: ['websocket'],
            upgrade: false
        });
        var choix;
        var questionActuelle = "";
        
        // --------- FONCTIONS UTILITAIRES ---------
        
        // R√©initialiser l'affichage du round
        function resetRound() {
    document.getElementById("round").style.display = 'none';
    document.getElementById("ChoixPileFace").style.display = 'none';
    document.getElementById("ResPileFace").style.display = 'none';

    // R√©initialiser texte et pi√®ce
    const coin = document.getElementById("coin");
    const affichage = document.getElementById("resultat");
    coin.style.transition = "none";
    coin.style.transform = "rotateY(0deg)";
    affichage.textContent = "";

    // Vider les conteneurs de question et pseudo
    document.getElementById("LaQuestion").innerHTML = "";
    document.getElementById("PhrasePseudo").innerHTML = "";
}
        // Afficher la pi√®ce imm√©diatement apr√®s le choix
        function afficherPieceAvantResultat() {
            const resDiv = document.getElementById("ResPileFace");
            const coin = document.getElementById("coin");
            const affichage = document.getElementById("resultat");
        
            resDiv.style.display = 'block';
            coin.style.transition = "none";
            coin.style.transform = "rotateY(0deg)";
            affichage.textContent = "";
        }
        
        // --------- FONCTIONS DE JEU ---------
        
        function rejoindreJeu() {
            const nomJoueur = document.getElementById("nomJoueur").value.trim();
            if (nomJoueur) {
                socket.emit('NouvJoueur', nomJoueur);
                document.getElementById("nomJoueur").value = "";
            } else {
                alert("Veuillez entrer un pseudo valide");
            }
        }
        
        function commencerJeu() {
            resetRound();
            document.getElementById("index").style.display = 'none';
            document.getElementById("round").style.display = 'block';
            socket.emit('lancerRound', 'd√©but');
            socket.emit('chargerQuestion', 'charger les question');
        }
        
        function demanderQuestion() {
            socket.emit('demandeQuestion', "envoi bb");
            document.getElementById("decrocher").style.display = 'none';
        }
        
        function afficherChoixPileFace() {
            document.getElementById("round").style.display = 'none';
            document.getElementById("ChoixPileFace").style.display = 'block';
        }
        
        function envoyerChoixP() {
            choix = "pile";
            afficherPieceAvantResultat(); // Affiche la pi√®ce tout de suite
            socket.emit("envoyerResPileFace", "envoie bb");
            document.getElementById("ChoixPileFace").style.display = 'none';
        }
        
        function envoyerChoixF() {
            choix = "face";
            afficherPieceAvantResultat(); // Affiche la pi√®ce tout de suite
            socket.emit("envoyerResPileFace", "envoie bb");
            document.getElementById("ChoixPileFace").style.display = 'none';
        }
        
        // Animation de la pi√®ce
        function lancerAnimationPileFace(resultat) {
    const coin = document.getElementById("coin");
    const affichage = document.getElementById("resultat");
    const round = document.getElementById('LaQuestion');

    let tours = 4;
    let angleFinal = (resultat === "pile") ? 0 : 180;

    coin.style.transition = "none";
    coin.style.transform = "rotateY(0deg)";
    void coin.offsetWidth;

    coin.style.transition = "transform 3s ease-out";
    coin.style.transform = `rotateY(${tours * 360 + angleFinal}deg)`;

    // Afficher imm√©diatement le conteneur de la pi√®ce
    document.getElementById("ResPileFace").style.display = 'block';

    setTimeout(() => {
    affichage.textContent = (choix === resultat) ? "üéâ GAGN√â !" : "‚ùå PERDU !";
    affichage.style.color = (choix === resultat) ? "green" : "red";

    if (choix === resultat){
        const ancienBtn = document.getElementById("btnAfficherQuestion");
        if (ancienBtn) ancienBtn.remove();
        let btnAfficherQuestion = document.createElement("button")
        btnAfficherQuestion.id = "btnAfficherQuestion";
        btnAfficherQuestion.textContent ="Afficher la question si p√©nalit√©"
        let ancienQuest = document.getElementById("affQuest")
        if (ancienQuest) ancienQuest.remove();
        let affQuest = document.createElement("span")
        affQuest.textContent = questionActuelle
        affQuest.id="affQuest"
        affQuest.style.display = 'none'
        affichage.parentNode.appendChild(affQuest)
        btnAfficherQuestion.onclick = () => {
           affQuest.style.display ='block'
           btnAfficherQuestion.style.display = 'none'
        }
        affichage.parentNode.appendChild(btnAfficherQuestion)
    }
    if (choix !== resultat){
        let ancienQuest = document.getElementById("affQuest")
        if (ancienQuest) ancienQuest.remove();
        let affQuest = document.createElement("span")
        affQuest.id="affQuest"
        affQuest.textContent = questionActuelle
        affichage.parentNode.appendChild(affQuest)
    }
    // Bouton pour lancer un nouveau round
    const ancienBtn = document.getElementById("btnNewRound");
    if (ancienBtn) ancienBtn.remove();
    let btnNewRound = document.createElement("button");
    btnNewRound.id = "btnNewRound"
    btnNewRound.textContent = "Nouveau Round";
    btnNewRound.onclick = () => {
        socket.emit('lancerRound', 'nouveau');
        resetRound();
        document.getElementById("round").style.display = 'block';
    };

    affichage.parentNode.appendChild(btnNewRound);
}, 3000);}
        
        // --------- SOCKETS ---------
        
        socket.on('majListe', (liste) => {
            const zone = document.getElementById("listeJoueurs");
            zone.innerHTML = "";
            liste.forEach(joueur => {
                const joueurDiv = document.createElement("div");
                joueurDiv.style.display = "flex";
                joueurDiv.style.alignItems = "center";
                joueurDiv.style.marginBottom = "5px";
        
                const nom = document.createElement("span");
                nom.textContent = joueur;
                nom.style.marginRight = "10px";
        
                const bouton = document.createElement("button");
                bouton.textContent = "‚ùå";
                bouton.onclick = () => {
                    socket.emit('SupprimerJoueur', joueur);
                };
        
                joueurDiv.appendChild(nom);
                joueurDiv.appendChild(bouton);
                zone.appendChild(joueurDiv);
            });
        });
        
        socket.on('AfficheNomJoueurR', (data) => {
            if (data) {
                const round = document.getElementById('PhrasePseudo');
                round.innerHTML = "";
        
                const phrase = document.createElement("span");
                phrase.textContent = data + " on t'appelle !";
        
                const bouton = document.createElement("button");
                bouton.id = "decrocher";
                bouton.textContent = "D√©crocher !";
                bouton.onclick = demanderQuestion;
        
                round.appendChild(phrase);
                round.appendChild(bouton);
                
            }
        });
        
        socket.on('AfficherQuestion', (data) => {
            if (data) {
                questionActuelle = "";
                questionActuelle = data
                const round = document.getElementById('LaQuestion');
                round.innerHTML = "";
        
                const phrase = document.createElement("span");
                phrase.textContent = data;
        
                const bouton = document.createElement("button");
                bouton.textContent = "Suivant";
                bouton.onclick = afficherChoixPileFace;
        
                round.appendChild(phrase);
                round.appendChild(bouton);
            }
        });
        
        socket.on('ResPileFace', (data) => {
            lancerAnimationPileFace(data);
        });
        </script>
        
</body>
</html>