<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>
<body>
    <div id="index">
        <h1>Jeu de la Pi√®ce</h1>
        <input type="text" id="nomJoueur" placeholder="Entrez votre nom">
        <button onclick="rejoindreJeu()">Rejoindre le jeu</button>
        <h3>Liste des joueurs :</h3>
        <div id="listeJoueurs"></div>
        <div id="commencer">
            <button onclick="commencerJeu()">START !</button>
        </div>
    </div>

    <div id="round" style="display: none;">
        <div id="PhrasePseudo"></div>
        <div id="LaQuestion"></div>
    </div>

    <div id="ChoixPileFace" style="display:none;">
        <h2>Choisis entre Pile et Face</h2>
        <button onclick="envoyerChoixP()">Pile</button>
        <button onclick="envoyerChoixF()">Face</button>
    </div>

    <div id="ResPileFace" style="display:none;">
        <div id="resultat" style="margin-top:20px; font-size:20px; font-weight:bold;"></div>
    </div>

    <script>
        var socket = io({ transports: ['websocket'], upgrade: false });
        var room = null;
        var pseudo = null;
        var choix;
        var questionActuelle = "";

        // Au chargement ‚Üí cr√©er une room unique pour ce joueur
        socket.emit("createRoom");

        socket.on("roomCreated", (roomId) => {
            room = roomId;
            console.log("Room priv√©e cr√©√©e:", room);
        });

        function rejoindreJeu() {
            pseudo = document.getElementById("nomJoueur").value.trim();
            if (pseudo && room) {
                socket.emit('NouvJoueur', {room: room, pseudo: pseudo});
                document.getElementById("nomJoueur").value = "";
            } else {
                alert("Veuillez entrer un pseudo valide");
            }
        }

        function commencerJeu() {
            document.getElementById("index").style.display = 'none';
            document.getElementById("round").style.display = 'block';
            socket.emit('lancerRound', {room: room});
            socket.emit('chargerQuestion', {room: room});
        }

        function demanderQuestion() {
            socket.emit('demandeQuestion', {room: room});
            document.getElementById("decrocher").style.display = 'none';
        }

        function envoyerChoixP() {
            choix = "pile";
            socket.emit("envoyerResPileFace", {room: room});
            document.getElementById("ChoixPileFace").style.display = 'none';
        }

        function envoyerChoixF() {
            choix = "face";
            socket.emit("envoyerResPileFace", {room: room});
            document.getElementById("ChoixPileFace").style.display = 'none';
        }

        // --- R√©ponses serveur ---
        socket.on('majListe', (liste) => {
            const zone = document.getElementById("listeJoueurs");
            zone.innerHTML = "";
            liste.forEach(joueur => {
                const div = document.createElement("div");
                div.textContent = joueur;
                zone.appendChild(div);
            });
        });

        socket.on('AfficheNomJoueurR', (data) => {
            if (data) {
                const round = document.getElementById('PhrasePseudo');
                round.innerHTML = data + " on t'appelle !";
                let bouton = document.createElement("button");
                bouton.id = "decrocher";
                bouton.textContent = "D√©crocher !";
                bouton.onclick = demanderQuestion;
                round.appendChild(bouton);
            }
        });

        socket.on('AfficherQuestion', (data) => {
            if (data) {
                questionActuelle = data;
                const round = document.getElementById('LaQuestion');
                round.innerHTML = data;
                let bouton = document.createElement("button");
                bouton.textContent = "Suivant";
                bouton.onclick = () => {
                    document.getElementById("round").style.display = 'none';
                    document.getElementById("ChoixPileFace").style.display = 'block';
                };
                round.appendChild(bouton);
            }
        });

        socket.on('ResPileFace', (data) => {
            document.getElementById("ResPileFace").style.display = 'block';
            const affichage = document.getElementById("resultat");
            affichage.textContent = (choix === data) ? "üéâ GAGN√â !" : "‚ùå PERDU !";
            affichage.style.color = (choix === data) ? "green" : "red";
        });
    </script>
</body>
</html>
